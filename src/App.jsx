import React,{useState,useRef,useEffect,useCallback}from'react';import{motion,AnimatePresence}from'framer-motion';import{Flame,Heart,Plus,Book,Download,Type,Image as ImageIcon,X,Trash2,Maximize,Minimize,RotateCcw,Star,Square,Circle,Share2,MessageCircle,Instagram,Send,Palette,Video,Music,Settings,Layers,Move,Sparkles,Wand2,AlignCenter,AlignLeft,AlignRight,Bold,Italic,ChevronUp,ChevronDown,Scissors,Eye,Lock,Unlock}from'lucide-react';import{toPng}from'html-to-image';export default function DeylinStudioUltimate(){const[style,setStyle]=useState('notebook');const[border,setBorder]=useState('none');const[elements,setElements]=useState([{id:'1',type:'text',content:'Toca para escribir algo especial...',x:0,y:0,size:35,rotate:0,font:"'Playfair Display'",color:'#1a1a1a',align:'center',weight:'normal',style:'normal',animation:'none',zIndex:10}]);const[selectedId,setSelectedId]=useState(null);const[activeSheet,setActiveSheet]=useState(null);const[exportModal,setExportModal]=useState(null);const[isRendering,setIsRendering]=useState(false);const[history,setHistory]=useState([]);const canvasRef=useRef(null);const fileRef=useRef(null);const saveHistory=useCallback(()=>{setHistory(prev=>[...prev.slice(-20),JSON.stringify(elements)]);},[elements]);const addElement=(type,content='',extra={})=>{saveHistory();const newEl={id:Date.now().toString(),type,content,x:0,y:0,size:type==='text'?30:180,rotate:0,opacity:1,zIndex:elements.length+1,mask:'none',filter:'none',...extra};setElements(prev=>[...prev,newEl]);setSelectedId(newEl.id);setActiveSheet(null);};const updateEl=(id,props)=>{setElements(prev=>prev.map(el=>el.id===id?{...el,...props}:el));};const deleteEl=(id)=>{saveHistory();setElements(prev=>prev.filter(el=>el.id!==id));setSelectedId(null);};const handleExport=async(type)=>{setSelectedId(null);setIsRendering(true);try{const dataUrl=await toPng(canvasRef.current,{pixelRatio:3,quality:1,cacheBust:true});setExportModal(dataUrl);}catch(e){console.error(e);}finally{setIsRendering(false);}};const selectedEl=elements.find(el=>el.id===selectedId);return(<div className="h-screen w-full bg-[#020202] text-white flex flex-col overflow-hidden select-none font-sans"><header className="p-4 flex justify-between items-center bg-black/80 backdrop-blur-2xl border-b border-white/5 z-[100] shadow-2xl"><div className="flex items-center gap-3"><div className="w-10 h-10 bg-gradient-to-tr from-orange-600 to-red-600 rounded-xl flex items-center justify-center shadow-lg shadow-orange-600/20"><Wand2 size={22}/></div><div><h1 className="font-black text-xl tracking-tighter bg-clip-text text-transparent bg-gradient-to-r from-white to-gray-500">DEYLIN PRO</h1><div className="flex gap-1 mt-[-2px] items-center"><div className="w-1 h-1 rounded-full bg-green-500 animate-pulse"/><span className="text-[7px] text-gray-500 uppercase tracking-[0.2em] font-bold">Creative Studio v4.0</span></div></div></div><div className="flex gap-2"><button onClick={()=>setActiveSheet('settings')} className="p-2.5 bg-white/5 rounded-xl border border-white/10 active:scale-90 transition-all"><Settings size={20}/></button><button onClick={()=>handleExport('video')} className="bg-gradient-to-r from-orange-500 to-red-600 px-6 py-2 rounded-xl font-black text-xs shadow-xl active:scale-95 flex items-center gap-2 tracking-widest uppercase">Listo</button></div></header><main className="flex-1 relative flex items-center justify-center p-4 bg-[radial-gradient(circle_at_center,#111_0%,#000_100%)] overflow-hidden"><div ref={canvasRef} onClick={()=>setSelectedId(null)} className={relative w-full max-w-[400px] aspect-[9/13] shadow-[0_100px_150px_rgba(0,0,0,0.9)] overflow-hidden transition-all duration-700 ease-in-out transform-gpu ${style==='notebook'?'bg-notebook':''} ${style==='burn'?'borde-quemado bg-[#f3e5ab]':''} ${style==='letter'?'bg-[#fffdf0] border-l-[40px] border-[#e0d9b0] shadow-2xl':''} ${style==='ancient'?'bg-[#c4a484] mix-blend-multiply opacity-90 shadow-inner':''} ${style==='cyber'?'bg-black border border-cyan-500/30 shadow-[0_0_50px_rgba(6,182,212,0.1)]':''} ${border==='gold'?'border-[18px] border-double border-[#d4af37] ring-4 ring-yellow-800/20 ring-inset':''} ${border==='neon'?'border-[4px] border-cyan-400 shadow-[0_0_40px_rgba(34,211,238,0.6)]':''} ${border==='floral'?'border-[25px] border-solid border-[#2d5a27] ring-8 ring-green-950/30':''} ${border==='retro'?'border-[15px] border-double border-red-900 bg-clip-content ring-offset-4 ring-offset-black':''} }><AnimatePresence>{elements.sort((a,b)=>a.zIndex-b.zIndex).map((el)=>(<motion.div key={el.id} drag dragMomentum={false} onClick={(e)=>{e.stopPropagation();setSelectedId(el.id);}} onDragStart={()=>setSelectedId(el.id)} className={absolute z-20 cursor-move ${selectedId===el.id?'ring-2 ring-orange-500 ring-offset-4 ring-offset-transparent outline-none shadow-2xl':''}} style={{x:el.x,y:el.y,rotate:el.rotate,width:el.type==='text'?'auto':el.size,zIndex:el.zIndex}} onDragEnd={(_,info)=>updateEl(el.id,{x:el.x+info.offset.x,y:el.y+info.offset.y})}>{el.type==='text'?(<div contentEditable spellCheck="false" onBlur={(e)=>updateEl(el.id,{content:e.target.innerText})} style={{fontFamily:el.font,fontSize:el.size,color:el.color,textAlign:el.align,fontWeight:el.weight,fontStyle:el.style}} className={outline-none min-w-[150px] whitespace-pre-wrap leading-tight drop-shadow-xl transition-all ${el.animation==='fade'?'animate-pulse':''}}>{el.content}</div>):(<div className="relative" style={{width:el.size,height:'auto'}}><img src={el.content} className="w-full h-auto block pointer-events-none drop-shadow-2xl" style={{filter:el.filter,clipPath:el.mask==='heart'?'path("M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z")':el.mask==='circle'?'circle(50%)':el.mask==='star'?'polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%)':'none'}}/></div>)}</motion.div>))}</AnimatePresence></div></main><AnimatePresence>{selectedId&&(selectedEl?.type==='text'?(<motion.div initial={{y:100}} animate={{y:0}} exit={{y:100}} className="fixed bottom-32 left-1/2 -translate-x-1/2 w-[95%] max-w-lg bg-black/95 backdrop-blur-3xl border border-white/10 rounded-3xl p-4 z-[110] flex flex-wrap justify-center gap-4 shadow-2xl"><div className="flex gap-2 border-r border-white/10 pr-4"><button onClick={()=>updateEl(selectedId,{size:selectedEl.size+2})} className="p-3 bg-white/5 rounded-xl"><Maximize size={20}/></button><button onClick={()=>updateEl(selectedId,{size:selectedEl.size-2})} className="p-3 bg-white/5 rounded-xl"><Minimize size={20}/></button></div><div className="flex gap-2 border-r border-white/10 pr-4"><button onClick={()=>updateEl(selectedId,{weight:selectedEl.weight==='bold'?'normal':'bold'})} className={p-3 rounded-xl ${selectedEl.weight==='bold'?'bg-orange-500':'bg-white/5'}}><Bold size={20}/></button><button onClick={()=>updateEl(selectedId,{align:'left'})} className="p-3 bg-white/5 rounded-xl"><AlignLeft size={20}/></button><button onClick={()=>updateEl(selectedId,{align:'center'})} className="p-3 bg-white/5 rounded-xl"><AlignCenter size={20}/></button></div><button onClick={()=>setActiveSheet('font')} className="p-3 bg-blue-500/20 text-blue-400 rounded-xl flex items-center gap-2 font-bold"><Type size={20}/> FUENTE</button><button onClick={()=>deleteEl(selectedId)} className="p-3 bg-red-500/20 text-red-500 rounded-xl"><Trash2 size={20}/></button></motion.div>):(<motion.div initial={{y:100}} animate={{y:0}} exit={{y:100}} className="fixed bottom-32 left-1/2 -translate-x-1/2 w-[95%] max-w-lg bg-black/95 backdrop-blur-3xl border border-white/10 rounded-3xl p-4 z-[110] flex flex-wrap justify-center gap-4 shadow-2xl"><button onClick={()=>updateEl(selectedId,{size:selectedEl.size+20})} className="p-3 bg-white/5 rounded-xl"><Maximize size={20}/></button><button onClick={()=>updateEl(selectedId,{size:selectedEl.size-20})} className="p-3 bg-white/5 rounded-xl"><Minimize size={20}/></button><button onClick={()=>updateEl(selectedId,{rotate:selectedEl.rotate+15})} className="p-3 bg-white/5 rounded-xl"><RotateCcw size={20}/></button><div className="flex gap-1 border-x border-white/10 px-4"><button onClick={()=>updateEl(selectedId,{mask:'heart'})} className="p-3 text-pink-500"><Heart size={20} fill="currentColor"/></button><button onClick={()=>updateEl(selectedId,{mask:'circle'})} className="p-3 text-cyan-400"><Circle size={20} fill="currentColor"/></button><button onClick={()=>updateEl(selectedId,{mask:'star'})} className="p-3 text-yellow-500"><Star size={20} fill="currentColor"/></button></div><button onClick={()=>deleteEl(selectedId)} className="p-3 bg-red-500/20 text-red-500 rounded-xl"><Trash2 size={20}/></button></motion.div>))}</AnimatePresence><nav className="p-5 grid grid-cols-5 gap-3 bg-[#0a0a0a] border-t border-white/5 z-50 shadow-[0_-20px_50px_rgba(0,0,0,0.5)]"><ToolBtn icon={<Sparkles/>} label="Papel" onClick={()=>setActiveSheet('paper')} color="text-orange-400" /><ToolBtn icon={<Layers/>} label="Bordes" onClick={()=>setActiveSheet('border')} color="text-cyan-400" /><ToolBtn icon={<Type/>} label="Texto" onClick={()=>addElement('text','Escribe algo...')} color="text-blue-400" /><ToolBtn icon={<Plus/>} label="Extra" onClick={()=>setActiveSheet('emoji')} color="text-pink-400" /><ToolBtn icon={<ImageIcon/>} label="Fotos" onClick={()=>fileRef.current.click()} color="text-purple-400" /></nav><input ref={fileRef} type="file" hidden accept="image/*" onChange={(e)=>{const file=e.target.files[0];if(file){const reader=new FileReader();reader.onload=(f)=>addElement('image',f.target.result);reader.readAsDataURL(file);}}} /><AnimatePresence>{activeSheet&&(<> <motion.div initial={{opacity:0}} animate={{opacity:1}} exit={{opacity:0}} onClick={()=>setActiveSheet(null)} className="fixed inset-0 bg-black/80 z-[120]"/><motion.div initial={{y:'100%'}} animate={{y:0}} exit={{y:'100%'}} className="fixed bottom-0 left-0 w-full bg-[#0f0f0f] rounded-t-[50px] p-10 z-[130] border-t border-white/10 shadow-2xl max-h-[85vh] overflow-y-auto"><div className="w-16 h-1.5 bg-white/10 rounded-full mx-auto mb-10"/>{activeSheet==='paper'&&( <div className="grid grid-cols-2 gap-6">{[{id:'notebook',label:'LIBRETA'},{id:'burn',label:'QUEMADO'},{id:'letter',label:'CARTA PRO'},{id:'ancient',label:'PERGAMINO'},{id:'cyber',label:'DARK TECH'}].map(p=>( <PaperCard key={p.id} label={p.label} active={style===p.id} onClick={()=>setStyle(p.id)} className={${p.id==='notebook'?'bg-notebook':''} ${p.id==='burn'?'borde-quemado bg-[#f3e5ab]':''} ${p.id==='letter'?'bg-[#fffdf0] border-l-8 border-yellow-200':''} ${p.id==='ancient'?'bg-[#8b4513] opacity-60':''} ${p.id==='cyber'?'bg-black border border-cyan-500':''}}/>))}</div>)}{activeSheet==='border'&&( <div className="grid grid-cols-1 gap-4">{[{id:'none',label:'SIN BORDE'},{id:'gold',label:'ORO REALISTA'},{id:'neon',label:'NE√ìN DIN√ÅMICO'},{id:'floral',label:'MARCO NATURAL'},{id:'retro',label:'ESTILO RETRO'}].map(b=>( <button key={b.id} onClick={()=>{setBorder(b.id);setActiveSheet(null);}} className={w-full p-6 rounded-3xl text-left font-black tracking-widest border-2 transition-all ${border===b.id?'border-orange-500 bg-orange-500/10 scale-[0.98]':'border-white/5 bg-white/5'}}>{b.label}</button>))}</div>)}{activeSheet==='font'&&( <div className="space-y-4">{["'Playfair Display'","'Caveat'","'Dancing Script'","'Indie Flower'","'Special Elite'","'Bebas Neue'","'Great Vibes'"].map(f=>( <button key={f} onClick={()=>{updateEl(selectedId,{font:f});setActiveSheet(null);}} className="w-full p-7 bg-white/5 rounded-[30px] text-left text-2xl border border-white/5 hover:bg-white/10 transition-all active:scale-95" style={{fontFamily:f}}>{f.split("'")[1]}</button>))}</div>)}{activeSheet==='emoji'&&( <div className="grid grid-cols-5 gap-8 text-5xl p-4 place-items-center">{['‚ú®','‚ù§Ô∏è','üî•','üëë','ü¶ã','üíé','üåπ','üß∏','‚≠ê','üåô','üç≠','üéÄ','üí∏','üßø','üì∏','üñ§','üî•','üßä','üåà','üß®'].map(e=>( <button key={e} onClick={()=>addElement('emoji',e)} className="active:scale-150 transition-all duration-300 transform-gpu hover:rotate-12">{e}</button>))}</div>)}</motion.div></>)}</AnimatePresence><AnimatePresence>{exportModal&&( <motion.div initial={{scale:1.2,opacity:0}} animate={{scale:1,opacity:1}} className="fixed inset-0 bg-black z-[200] flex flex-col items-center p-8 overflow-y-auto"><button onClick={()=>setExportModal(null)} className="absolute top-8 right-8 p-4 bg-white/5 rounded-full backdrop-blur-xl border border-white/10 active:rotate-90 transition-all"><X size={28}/></button><h2 className="text-4xl font-black mb-10 mt-10 tracking-tighter italic">OBRA MAESTRA</h2><div className="w-full max-w-sm aspect-[9/13] rounded-[40px] overflow-hidden shadow-[0_50px_100px_rgba(0,0,0,1)] border border-white/20 mb-12 relative group"><img src={exportModal} className="w-full h-full object-cover"/><div className="absolute inset-0 bg-gradient-to-t from-black/60 to-transparent opacity-0 group-hover:opacity-100 transition-opacity flex items-end p-6"><p className="font-bold text-xs tracking-widest">¬© DEYLIN STUDIO PREMIUM</p></div></div><div className="w-full max-w-md space-y-6"><button onClick={()=>{const a=document.createElement('a');a.download='deylin_studio_pro.png';a.href=exportModal;a.click();}} className="w-full py-6 bg-white text-black rounded-[30px] font-black text-xl flex items-center justify-center gap-4 shadow-[0_20px_40px_rgba(255,255,255,0.2)] active:scale-95 transition-all"><Download size={28}/> GUARDAR GALER√çA</button><div className="grid grid-cols-4 gap-4">{[{icon:<MessageCircle/>,label:'WA',color:'bg-green-600',url:'whatsapp://send'},{icon:<Instagram/>,label:'IG',color:'bg-gradient-to-tr from-yellow-500 via-purple-500 to-pink-500'},{icon:<Send/>,label:'TG',color:'bg-blue-500'},{icon:<Share2/>,label:'OTRO',color:'bg-gray-800'}].map(s=>( <button key={s.label} className="flex flex-col items-center gap-3 active:scale-90 transition-all"><div className={w-16 h-16 ${s.color} rounded-full flex items-center justify-center shadow-xl}>{React.cloneElement(s.icon,{size:24,color:'white'})}</div><span className="text-[10px] font-black opacity-50 uppercase tracking-widest">{s.label}</span></button>))}</div><div className="pt-6 border-t border-white/5 flex justify-center gap-8 opacity-40"><span className="text-[10px] font-bold">TIKTOK</span><span className="text-[10px] font-bold">FACEBOOK</span><span className="text-[10px] font-bold">REELS</span></div></div></motion.div>)}</AnimatePresence>{isRendering&&( <div className="fixed inset-0 bg-black/95 z-[300] flex flex-col items-center justify-center"><div className="w-24 h-24 border-[6px] border-orange-600 border-t-transparent rounded-full animate-spin mb-8 shadow-[0_0_50px_rgba(234,88,12,0.4)]"/><p className="font-black text-2xl tracking-[0.5em] animate-pulse italic">DEYLIN RENDER ENGINE...</p></div>)}<style>{.bg-notebook{background-color:#fff;background-image:linear-gradient(90deg,transparent 79px,#ffb3b3 79px,#ffb3b3 81px,transparent 81px),linear-gradient(#e5e7eb 1.5px,transparent 1.5px);background-size:100% 2.8rem;box-shadow:inset 10px 0 20px rgba(0,0,0,0.05);} .borde-quemado{clip-path:polygon(0% 2%,15% 0%,35% 4%,55% 1%,75% 6%,95% 0%,100% 5%,98% 30%,100% 60%,97% 85%,100% 100%,80% 98%,50% 100%,20% 97%,0% 100%,2% 75%,0% 45%,4% 15%);box-shadow:inset 0 0 120px #5d4037,0 40px 80px rgba(0,0,0,0.7);background-image:url('[https://www.transparenttextures.com/patterns/stardust.png](https://www.transparenttextures.com/patterns/stardust.png)');}}</style></div>);}function ToolBtn({icon,label,onClick,color}){return(<button onClick={onClick} className="flex flex-col items-center gap-2 active:scale-90 transition-all group"><div className={p-4 bg-white/5 rounded-3xl mb-1 group-hover:bg-white/10 transition-colors shadow-inner ${color}}>{React.cloneElement(icon,{size:24})}</div><span className="text-[9px] font-black text-gray-600 uppercase tracking-widest">{label}</span></button>);}function PaperCard({label,active,onClick,className}){return(<div onClick={onClick} className={relative aspect-square rounded-[40px] cursor-pointer overflow-hidden border-4 transition-all duration-500 ${active?'border-orange-500 scale-95 shadow-[0_0_40px_rgba(249,115,22,0.4)]':'border-transparent opacity-30 hover:opacity-100 hover:scale-105'}}><div className={w-full h-full ${className}}/><div className="absolute inset-0 flex items-center justify-center bg-black/40"><span className="text-white font-black text-xs tracking-[0.2em]">{label}</span></div></div>);}
